
@{
    ViewBag.Title = "Index";
}


@using Resources2 = TetraTech.TTProjetPlus.Views.Home
@using Resources = TetraTech.TTProjetPlus.Views.TTProjet
@model List<TetraTech.TTProjetPlus.Data.ST_descriptions_listeEnvoie_types>
<style>
</style>

@{
    ViewBag.Title = "Admin TI";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    .ui-autocomplete {
        z-index: 2147483647;
    }

    .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn) {
        width: 30%;
    }
    }
</style>
<div id="loading">
    <img id="loadingGIF2" src="~/Content/assets/img/ajax-loader.gif" alt="Loading..." />
</div>

<div class="container " style="height: 200vh;width: 100%">
    <div class="main">

        @if (ViewBag.MenuVisible == "true")
        {
            <div class="row">
                <div class="row">
                    <div class="col-lg-4" style="padding-top: -49px;">
                        <div class="panel" style="border-radius: 10px; margin-left: -10px; height: 100px;">
                            <div class="panel-body">
                                <ul class="list-inline">
                                    <li><a style=" color:#183666;" href="@Url.Action("Index", "TTProjet" )">TT Projet +  /</a></li>
                                    <li><a style="color:#183666; font-weight: bold" href="@Url.Action("Index", "TTProjet", new { selectedPanel = "collapse8" })">Informations supplémentaires</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="">
                            <div class="panel" style="border-radius: 10px; margin-left: -10px; height: 100px; ">
                                <div class="panel-body">
                                    <ul class="">
                                        <li>
                                            <a style="color: #183666; " href="@Url.Action("Index", "AdditionaInfo")">Liste des gestionnaires de projet et de programme</a>
                                        </li>
                                        <li>
                                            <a style="color: #183666; " href="@Url.Action("Index", "TDT_PSWListe_BD")">Liste des mots de passe pour les tables de taux</a>
                                        </li>
                                        <li>
                                            <a style="color:#183666 ; " href="@Url.Action("Index", "TDT_PSWPermission")">Liste des permissions pour les tables de taux</a>
                                        </li>
                                        <li>
                                            <a style="color: #183666; font-weight: bold" href="@Url.Action("Index", "SaisieTemporaire")">Saisies temporaires</a>
                                        </li>


                                    </ul>
                                </div>
                            </div>

                        </div>

                    </div>
                    @*<div class="col-lg-4">
                            <div class="">
                                <div class="panel" style="border-radius: 10px; margin-left: -10px; height: 100px; ">
                                    <div class="panel-body">
                                        <ul class="list-inline">
                                            <li>
                                                &bull;&nbsp;<a style="color:#183666 " href="@Url.Action("Index", "SecurityProjectEquivalence")">Équivalence des projets</a>
                                            </li>
                                            <br>
                                            <li>
                                                &bull;&nbsp;<a style="color:#183666 ;" href="@Url.Action("Index", "Litige")">@Resources.TTProjet.LitigeManagement</a>
                                            </li>
                                            <br>
                                            <li>
                                                &bull;&nbsp;<a style="color:#183666 ;" href="@Url.Action("Index", "LocalBPR")">@Resources.TTProjet.EmployeeInfos</a>
                                            </li>
                                            <br>
                                            <li>
                                                &bull;&nbsp;<a style="color: #183666" href="@Url.Action("Index3", "FolderStructure")">@Resources.TTProjet.Security60Conf</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                        </div>*@

                </div>

            </div>

        }
        <div class="">
            <div class="row">
                <div class="panel panel-primary" style="border-radius: 10px; margin-top: -10px; margin-bottom: 10px; margin-left: -10px;">
                    <div class="panel-body" style="margin:15px;">
                        <div class="row">
                            <div class="col-sm-6">

                                <div class="col-sm-12">
                                    <h4 style="margin-top: 0px; color: #183666; font-family: 'Arial Bold'; font-size: 18pt; margin-left: 10px;">
                                        <b>Modifier la liste d'envoie des saisies temporaire:</b>
                                    </h4>
                                </div>

                                <br />

                                <div class="row">
                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <label for="text">Nom de l'employé:</label>
                                            <input type="text" class="form-control" id="nom_emp" placeholder="Entrer le nom" name="nom_emp">
                                        </div>

                                    </div>

                                </div>
                                <div class="row">

                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <label for="multiSelectForType">Type d'envoie:</label>
                                            <select class="selectpicker form-control" multiple data-live-search="true" style="width:45%" id="multiSelectForType">
                                                <option value="">Choisir un type d'envoie..</option>
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <button class="btn btn-primary" style="text-align: right" onclick="addTypesToEmp()">Soumettre</button>
                            </div>
                            <div class=" col-sm-6">
                                <div class="" style="height: 400px; overflow-y: scroll;">
                                    <p>Légende:</p>
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Type</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @for (int i = 0; i < Model.Count(); i++)
                                            {
                                                <tr>
                                                    <td>@Model[i].code</td>
                                                    <td>@Model[i].description</td>
                                                </tr>

                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <br />
                        <br />
                        <div id="info">

                        </div>

                    </div>
                </div>

            </div>

        </div>

    </div>

</div>

</div>
<script>
    $(document).ready(function () {

        $('.selectpicker').selectpicker(
        );
    });


    function displayListe() {
                $.ajax({
                url: '@Url.Action("displayInfo", "TDT_PSWPermission")',
                    type: 'GET',
                    cache: false,
                data: {
                    typeListe: $('#typeList').val()
                },
                success: function (data)
                {
                    $('#info').html(data)
                }
            });
    }




    $('#addButton').on('click', function () {
        var type = $('#typeList').val() == "" ? "moyenne" : $('#typeList').val()
        $('#listTypeModel').text(type);
        if (type == "approbateurs") {
            $('.f1').hide()
            $('.f2').show()
        }
        else {
            $('.f2').hide()
            $('.f1').show()
        }

    });

    //autocomplete our charge de projet dans le modal
$(function() {
var array = @Html.Raw(Json.Encode(@ViewBag.GestionnairesNumberArray));
var numberArray = [];
for (var i = 0; i < array.length; i++) {
numberArray[i] = { value: array[i], label: array[i] };
}
        $( "#nom_emp" ).autocomplete({
source: numberArray,
focus: function( event, ui ) {
    $( "#nom_emp" ).val( ui.item.label );
return false;
        }
,
    change: function (event, ui) {
        if ($("#nom_emp").val() != "") {
            if (ui.item === null || !ui.item)
                $("#nom_emp").val("@Resources2.informations.notExistingProgramManager".replace('&#39;','\''));
        }

    }

    })
.autocomplete( "instance" )._renderItem = function( ul, item ) {
return $( "<li>" )
.append( "<div>" + item.label + "</div>" )
.appendTo( ul );
};
});


    $('input[name=nom_emp]').change(function ()
    {
        $('#multiSelectForType').empty()

        $.ajax
            ({
                url: '@Url.Action("returnSendingTypeForEmp", "SaisieTemporaire")',
                    type: 'GET',
                 cache: false,
                 dataType: "json",
                 data: {
                     nom: $('#nom_emp').val()
                },
                success: function (data)
                {
                    //ici il faut aller cocher les options qui existent deja pour l employé:
                    if (data != "null")
                    {
                        var json = JSON.parse(data);

                        items = [];

                        for (var prop in json)
                        {
                            if (prop != "Nom" && prop != "ID")
                            {
                                if (json[prop] == "oui") {
                                    items.push(prop);
                                    $("#multiSelectForType").append("<option class='optionMS' value='" + prop.replace(/_/g, '-') + "' selected>" + prop.replace(/_/g, '-') + "</option>");

                                }
                                else {
                                    $("#multiSelectForType").append("<option class='optionMS' value='" + prop.replace(/_/g, '-') + "'>" + prop.replace(/_/g, '-') + "</option>");
                                }

                            }
                        }
                        $('.selectpicker').selectpicker('refresh');
                    }
                    else
                    {


                 $.ajax({
                     url: '@Url.Action("returnSendingType", "SaisieTemporaire")',
                    type: 'GET',
                    cache: false,
                   success: function (data)
                   {


                       $('#multiSelectForType').empty()
                       var json = JSON.parse(data);

                       items = [];

                       for (var i = 0; i < json.length ; i++) {
                           if (json[i] != "Nom" && json[i] != "ID") {
                               $("#multiSelectForType").append("<option class='optionMS' value='" + json[i].replace(/_/g, '-') + "'>" + json[i].replace(/_/g, '-') + "</option>");

                           }
                       }

                       $('.selectpicker').selectpicker('refresh');

                    }
                  });


                        @*var array = '@Model';
                        var len = array.length;

                        for (var i = 0;  i < len ; i++ )

                            if (array[i].code != "Nom" && array[i].code != "ID")
                            {
                                $("#multiSelectForType").append("<option class='optionMS' value='" + array[i].replace(/_/g, '-') + "'>" + array[i].replace(/_/g, '-') + "</option>");
                            }*@

                    }
                  }


            });

    });



    function addTypesToEmp()
    {

        var typeForEmp = $("#multiSelectForType").val() // c est un array
         $.ajax({
                url: '@Url.Action("addTypesToEmp", "SaisieTemporaire")',
                    type: 'GET',
                    cache: false,
                data: {
                    typesListe: JSON.stringify(typeForEmp),
                    empNom: $('#nom_emp').val()
                },
                success: function (data)
                {
                    if (data == "true") {

                        alert("Opération réussi dans la table des type d'envoies")
                    }
                    else {
                        alert("L'opération a échoué")
                    }
                }
            });
    }




     //////////////////////////
    const chBoxes =
        document.querySelectorAll('.dropdown-menu input[type="checkbox"]');
    const dpBtn =
        document.getElementById('multiSelectDropdown');
    let mySelectedListItems = [];

    function handleCB() {
        mySelectedListItems = [];
        let mySelectedListItemsText = '';

        chBoxes.forEach((checkbox) => {
            if (checkbox.checked) {
                mySelectedListItems.push(checkbox.value);
                mySelectedListItemsText += checkbox.value + ', ';
            }
        });

        dpBtn.innerText =
            mySelectedListItems.length > 0
                ? mySelectedListItemsText.slice(0, -2) : 'Select';
    }

    chBoxes.forEach((checkbox) => {
        checkbox.addEventListener('change', handleCB);
    });
</script>
