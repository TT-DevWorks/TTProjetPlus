@using Resources = TetraTech.TTProjetPlus.Views.ManageDirectoryRights
@using TetraTech.TTProjetPlus.Models;
@model TetraTech.TTProjetPlus.Models.ManageDirectoryRightsDetails

@if (!string.IsNullOrEmpty(Model.SelectedProject))
{
<div class="panel-body">
    <div id="group-members" class="row">

        @if (Model != null && Model.DirectoryAccessList.Count() > 0)
        {            
            <div class="panel pagination-grey clearfix m-b-0">
                <div id="table-memberslist" class="dataTables_wrapper form-inline dt-bootstrap no-footer">

                    <table id="data_Members" class="table table-bordered  data-table  dataTable" style="width: 100%">
                        <thead id="tableHeaderGP">
                            <tr class="grey" role="row">
                                <th class="sorting" tabindex="1" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Run ID: activate to sort column ascending" style="width: 40%">
                                    @Resources.MDRessources.Name2
                                </th>
                                <th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Run ID: activate to sort column ascending" style="width: 15%">
                                    @Resources.MDRessources.AccessIn
                                </th>
                                <th class="sorting" tabindex="2" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Run ID: activate to sort column ascending" style="text-align: center;width: 25%">
                                    @Resources.MDRessources.AccessKM
                                </th>
                                <th style="width: 20%">
                                    &nbsp;
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (DirectoryAccess item in Model.DirectoryAccessList)
                            {
                                <tr>
                                    <td style="text-align: left;width: 40%">
                                        @item.Value
                                    </td>
                                    <td style="text-align: left;width: 15%">
                                        @item.Permission
                                    </td>
                                    <td style="text-align: center;width: 25%">@item.AccesTetraLinx</td>
                                    <td style="text-align: left;width: 10%">
                                        @if (item.SecurityAuthentificationTypeID == 3)
                                        {
                                            <a href="" class="btn btn-default editor_remove"> <span class="k-icon k-i-close"></span> @Resources.MDRessources.Delete2</a>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
        else
        {
            if (Model == null)
            {
                @Html.Partial("Error")
            }
            else
            {
                @*<div class="abc alert alert-warning" role="alert">
                        <span>@Resources.MessageNoMembersInGroup.</span>
                    </div>*@
                @*<div class="alert alert-warning" role="alert">
                        <span>@Resources.MessageNoMembersInGroup.</span>
                    </div>
                    <div class="alert alert-warning" id="warningModifySpecialModele">
                        <p><strong>Accès de base en ÉCRITURE commun à tous les projets pour le répertoire 10:</strong></p>
                        <p>1) Groupe Administration</p>
                        <p>2) Groupe Direction Développement des Affaires (DDA)</p>
                        <p>3) Groupe Services Administratifs</p>
                        <p>4) Membres clés définis dans Tetra Linx</p>
                    </div>*@
            }
        }
    </div>
</div>
}

<script>

var data_MembersTable;
$(document).ready(function () {
 $('#data_Members').DataTable({
                   order: [[1, "desc"]],
            pageResize: true,
            pageLength: 10,
            select: true,
            scrollX: true,
            scrollY: $(window).height() <= 722 ? $(window).height() / 2.25 : $(window).height() / 1.75,
            scrollCollapse: true,
            language: {
                "url": '@Session["lang"].ToString()' == 'fr' ? "/Content/assets/French.json" : "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/English.json"
            }
    });
});


$('#data_Members').on('click', 'a.editor_remove', function (e) {
    e.preventDefault();
    var row =$(this).closest('tr');
    var item=$('#data_Members').dataTable().fnGetData(row);
    var data = { SelectedEmployeeName: item[0], SelectedPermissionFromEmployeeObj: item[1]};

    $.post('@Url.Action("RemoveEmployeeFromDirectoryRight", "ManageDirectoryRights")', data, function (result) {
        if (result.success) {
            refreshDetailsGroupMembersSection();
            $('#btnSave').removeAttr('disabled');
            $('#btnSave').removeClass("buttonInactif");
            $("#MessageSave").show();
        }
        else
        {
            $(".details-messages.alert-danger span").text(result.errors.join());
            $(".details-messages.alert-danger").show().delay(2000).slideUp( 300 );;
        }
    });
} );

</script>

