@using Resources2 = TetraTech.TTProjetPlus.Views.ListeOffres
@using ResourcesB = TetraTech.TTProjetPlus.Views.Boomerang.searchCriteria
@using Resources = TetraTech.TTProjetPlus.Views.InfoProjet
@using TetraTech.TTProjetPlus.Controllers
<link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">
<style>


    .bd-example {
        position: relative;
        padding: 1rem;
        margin: 1rem -.75rem 0;
        border: solid #dee2e6;
        border-width: 1px 0 0;
    }

    .panel-body {
        margin-left: 30px;
        margin-right: 30px;
        margin-bottom: -25px
    }

    .form-control {
        border-radius: 0px;
    }

    .list-inline {
        margin-bottom: 19px;
    }

    #myUL {
        margin: 0;
        padding: 0;
        list-style-type: none;
    }


    .caret2 {
        cursor: pointer;
        -webkit-user-select: none; /* Safari 3.1+ */
        -moz-user-select: none; /* Firefox 2+ */
        -ms-user-select: none; /* IE 10+ */
        user-select: none;
    }

        .caret2::before {
            content: "\25B6";
            color: black;
            display: inline-block;
            margin-right: 6px;
        }

    .caret2-down::before {
        -ms-transform: rotate(90deg); /* IE 9 */
        -webkit-transform: rotate(90deg); /* Safari */
        transform: rotate(90deg);
    }

    .nested {
        display: none;
        list-style-type: none;
    }

    .active {
        display: block;
        list-style-type: none;
    }
</style>
<div class="form-horizontal">
    <div class="container" style="height: 200vh; width: 100%">
        <div class="main">
            <div class="row">
                <div class="row">
                    <div class="col-lg-3" style="padding-top:-49px;">
                        <div class="panel" style="border-radius: 10px; width: 106%;">
                            <div class="panel-body">
                                <ul class="list-inline">
                                    <li><a style=" color:#183666;" href="@Url.Action("Index", "TTProjet")">TT Projet +  /</a></li>
                                    <li><a style=" color:#183666; font-weight: bold" href="@Url.Action("Index", "TTIndex")">@Resources2.ListeProjetsRessources.TTIndex</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="">
                            <div class="panel" style="border-radius: 10px; ">
                                <div class="panel-body">
                                    <ul class="list-inline">
                                        <li>
                                            &bull;&nbsp;<a style="color:#183666" href="@Url.Action("Index", "Home")">@Resources2.ListeProjetsRessources.GenerateProjectNumber</a>

                                        </li>

                                        <li>
                                            &bull;&nbsp;<a style="color:#183666 " href="@Url.Action("Index", "ListeOffres")">@Resources2.ListeProjetsRessources.OffersList</a>

                                        </li>
                                        <li>
                                            &bull;&nbsp;<a style="color:#183666 " href="@Url.Action("IndexProjet", "ListeOffres")">@Resources2.ListeProjetsRessources.ProjectsList</a>

                                        </li>
                                        <li>
                                            &bull;&nbsp;<a style="color:#183666;" href="@Url.Action("Index", "InfoProjet")">@Resources2.ListeProjetsRessources.InfoProject</a>

                                        </li>
                                        <li>
                                            &bull;&nbsp;<a style="color:#183666" href="@Url.Action("Index", "ProjectToClose")">@Resources2.ListeProjetsRessources.ProjectToCloseTitle</a>
                                        </li>
                                        <li>
                                            &nbsp;&nbsp;&bull;
                                            <a style="color:#183666;font-weight: bold;" href="@Url.Action("Index", "TTIndex")" target="_blank">@Resources2.ListeProjetsRessources.TTIndex</a>
                                        </li>
                                        <li>
                                            &bull;&nbsp;
                                            <a style="color:#183666;" href="@System.Configuration.ConfigurationManager.AppSettings["BoomerangUrl"]" target="_blank">@Resources2.ListeProjetsRessources.Boomerang</a>
                                        </li>
                                        <li>
                                            &bull;&nbsp;
                                            <a style="color:#183666;" href="@Url.Action("Index", "OpenProject")" >@Resources2.ListeProjetsRessources.ProjectOpening</a>
                                        </li>

                                    </ul>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
            </div>

            <div class="row">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-primary" style="border-radius: 10px;margin-top: -10px;margin-bottom:10px;padding-bottom: 15px;">

                            <div class="panel-body" style="margin-bottom: -32px;">
                                <div class="row form-group">
                                    <div class="col-lg-2">
                                        <select data-live-search="true" class="form-control selectpicker " id="id_fileType" data-size="10" data-selected-text-format="count>2" data-all="false" style="color: #999" title="Folders">

                                            @foreach (string item in TTIndexController.listProjects)
                                            {

                                                <option class="opt" value="@item" style="">@item</option>

                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-2">
                                        <input type="text" class="form-control" id="pathKeyword" placeholder="Path keyword" style="padding-left: 10px">
                                    </div>
                                    <div class="col-lg-2">
                                        <input type="text" class="form-control" id="fileKeyword" placeholder="File keyword" style="padding-left: 10px">
                                    </div>


                                    <div class="col-lg-2">
                                        <input type="text" name="datefilter" class="form-control formControl2" id="dateCreation" placeholder="Creation date" maxlength="10" style="padding-left: 10px" />
                                    </div>

                                    <div class="col-lg-2">
                                        <button type="button" id="submitButton" class="btn btn-primary">Search</button>
                                    </div>
                                    <div class="col-lg-1">
                                        <button onclick="displayDoc2()">click</button>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
               
            </div>
          
            <div class="row">
                <div class="row">
                    <div class="col-lg-12">

                        <div class="panel panel-primary" style="border-radius: 10px">


                            <div class="panel-body">
                                <div class="row form-group">

                                    <div id="searchResults">



                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="accessDeniedModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Avertissement</h4>
            </div>
            <div class="modal-body">
                <b>L'accès au fichier <span style='color:red' id="folderName"></span> vous est interdit.</b>
                <div>
                    <b>Détails:</b>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
            </div>
        </div>

    </div>
</div>
<div class="modal fade" id="tree2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Structure du dossier</h4>
            </div>
            <div class="modal-body">
                <div id="treeContent">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
            </div>
        </div>

    </div>
</div>
<script>
    $(document).ready(function () {

        $('.selectpicker').selectpicker(

            {
    }
    );
                  //ref pour multiselect  https://www.jqueryscript.net/demo/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/
            $('.selectpickerM').multiselect({
                nonSelectedText: 'Folders',
                allSelectedText: '@Session["lang"].ToString()' == 'fr'? 'Toutes les options sont sélectionnée':'All the options are selected',
                numberDisplayed: 1,
                buttonWidth: '100%',
                includeSelectAllOption: true,
                selectAllText: '@Session["lang"].ToString()' == 'fr' ? 'Tout sélectionner' : 'Select all',
                nSelectedText : '@Session["lang"].ToString()' == 'fr' ? 'Sélectionné(s)' : 'Selected',
                enableCaseInsensitiveFiltering: true,
                maxHeight: 400,
                filterPlaceholder: '@Session["lang"].ToString()' == 'fr'? 'Recherche':'Search'
            });

        });
        $('#submitButton').click(function (e) {

        $('#searchResults').html('');
        $.ajax({
            type: 'GET',
            url: '@Url.Action("submitSearch", "TTIndex")',
            traditional: true,
            dataType: "html",
            data:
            {
                folder: $('#id_fileType').val(),
                pathKeyword: $('#pathKeyword').val(),
                fileKeyword: $('#fileKeyword').val(),
                extensionsArray: $(".selectpickerM").val(),
                dateCreation: $('#dateCreation').val()

            },
            success: function (response) {
                $('#searchResults').html(response);
            },
            error: function () {

            }
        });
        });
    $(document).on('click', '.caret2',function () {
        this.parentElement.querySelector(".nested").classList.toggle("active");
        this.classList.toggle("caret2-down");
    });
        $(function () {
        if ('@Session["lang"].ToString()' == 'fr') {
            $('input[name="datefilter"]').daterangepicker({
                "autoUpdateInput": false,
                "locale": {
                    "format": "YYYY-MM-DD",
                    "separator": " - ",
                    "applyLabel": "Appliquer",
                    "cancelLabel": "Annuler",
                    "fromLabel": "De",
                    "toLabel": "A",
                    "customRangeLabel": "Personnalisé",
                    "daysOfWeek": [
                        "Dim",
                        "Lun",
                        "Mar",
                        "Mer",
                        "Jeu",
                        "Ven",
                        "Sam"
                    ],
                    "monthNames": [
                        "Janvier",
                        "Février",
                        "Mars",
                        "Avril",
                        "Mai",
                        "Juin",
                        "Juillet",
                        "Août",
                        "Septembre",
                        "Octobre",
                        "Novembre",
                        "Décembre"
                    ],
                    "firstDay": "0"
                },
                ranges: {
                    'Aujourd\'hui': [moment(), moment()],
                    'Hier': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    '7 derniers jours': [moment().subtract(6, 'days'), moment()],
                    '30 derniers jours': [moment().subtract(29, 'days'), moment()],
                    'Ce mois-ci': [moment().startOf('month'), moment().endOf('month')],
                    'Le mois dernier': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                "alwaysShowCalendars": false

            });
        }
        else {
            $('input[name="datefilter"]').daterangepicker(
                {
                    "autoUpdateInput": false,
                    "locale": {
                        "format": "YYYY-MM-DD",
                        "separator": " - ",
                        "applyLabel": "Apply",
                        "cancelLabel": "Cancel",
                        "fromLabel": "From",
                        "toLabel": "To",
                        "customRangeLabel": "Customized",


                        "firstDay": "0"
                    },
                    ranges: {
                        'Today': [moment(), moment()],
                        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        '7 last days': [moment().subtract(6, 'days'), moment()],
                        '30 last days': [moment().subtract(29, 'days'), moment()],
                        'This month': [moment().startOf('month'), moment().endOf('month')],
                        'Last month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    },
                    "alwaysShowCalendars": false

                });
        }

        $('input[name="datefilter"]').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('YYYY-MM-DD') + ' - ' + picker.endDate.format('YYYY-MM-DD'));
        });

        $('input[name="datefilter"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

        });

    function displayDoc2(currentPath) {
        
                $.ajax({
            type: 'GET',
            url: '@Url.Action("downloadDoc", "TTIndex")',
            traditional: true,
            dataType: "json",
            data:
            {
                
            },
                    success: function (response) {
                        if (response.result == "success")
                            alert("success!")
                        else {
                            alert(response.details1 + " / " + response.details2)
                        }
            },
            error: function () {

            }
        });
    }
   
   
</script>
