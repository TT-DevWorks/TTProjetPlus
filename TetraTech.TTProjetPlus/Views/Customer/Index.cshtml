@using Resources = TetraTech.TTProjetPlus.Views.TTProjet
@using Resources1 = TetraTech.TTProjetPlus.Views.Customer
@using Resources2 = TetraTech.TTProjetPlus.Views.FolderStructure
@model TetraTech.TTProjetPlus.Models.CustomerModel
@using TetraTech.TTProjetPlus.Security

@{
    var currentUser = UserService.CurrentUser;

}


<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"></script>
<script type="text/javascript" src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>
<link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet" media="screen">
<link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css" rel="stylesheet" media="screen">
<link href="https://cdn.datatables.net/select/1.3.4/css/select.dataTables.min.css" rel="stylesheet" media="screen">
<link href="https://cdn.datatables.net/datetime/1.1.2/css/dataTables.dateTime.min.css" rel="stylesheet" media="screen">
<link href="https://editor.datatables.net/extensions/Editor/css/editor.dataTables.min.css" rel="stylesheet" media="screen">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />

<style>
    #data_customer {
        width: 100% !important;
    }

        #data_customer td {
            text-overflow: ellipsis;
            overflow: hidden;
        }

        #data_customer th {
            white-space: normal;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }
</style>



<div class="container " style="height: 200vh;width: 100%;">
    <div class="main">
        <div class="row">
            <div class="row">
                <div class="col-lg-3" style="padding-top: -49px;">
                    <div class="panel" style="border-radius: 10px; margin-left: -10px; height: 75px;">
                        <div class="panel-body">
                            <ul class="list-inline">
                                <li><a style=" color:#183666;" href="@Url.Action("Index", "TTProjet" )">TT Projet +  /</a></li>                                
                                <li style="color:white ; font-weight: bold"><a href="@Url.Action("Index", "Customer")"> @Resources.TTProjet.Advanced</a></li>

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="">
                        <div class="panel" style="border-radius: 10px; margin-left: -10px; height: 75px">
                            <div class="panel-body">
                                <ul class="list-inline">

                                    <li>
                                        &bull;&nbsp;
                                        <a style="color: #183666; font-weight: bold" href="@Url.Action("Index", "Customer")">@Resources.TTProjet.AddCustomer</a>
                                    </li>
                                    <li>
                                        &bull;&nbsp;
                                        <a style="color:#183666" href="@Url.Action("TTProjetFolderStructure", "TTProjet")">@Resources.TTProjet.CreateFolderStructure</a>
                                    </li>


                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" style="color:steelblue; font-size:initial">
            <div class="row form-group">
                <div class="col-sm-12">
                    <div class="panel pagination-grey" style="border-radius: 10px; margin-left: -10px; margin-top: -10px; ">
                        <div class="row">
                            <div class="">
                                <div class="alert alert-warning" id="alreadyExists" hidden="hidden" style="margin:30px;">
                                    <button type="button" class="close" data-hide="alert">&times;</button>
                                    <strong>@Resources1.Customer.CustomerExist</strong>
                                </div>

                                <div class="alert alert-warning" id="CustomerNameMissing" hidden="hidden" style="margin:30px;">
                                    <button type="button" class="close" data-hide="alert">&times;</button>
                                    <strong>@Resources1.Customer.CustomerNameMissing</strong>
                                </div>

                                <div class="alert alert-warning" id="CustomerNumberMissing" hidden="hidden" style="margin:30px;">
                                    <button type="button" class="close" data-hide="alert">&times;</button>
                                    <strong>@Resources1.Customer.CustomerNumberMissing</strong>
                                </div>

                                <div class="alert alert-warning" id="ValNumeric" hidden="hidden" style="margin:30px;">
                                    <button type="button" class="close" data-hide="alert">&times;</button>
                                    <strong>@Resources1.Customer.ValNumeric</strong>
                                </div>

                                <div class="alert alert-success" id="successAdd" hidden="hidden" style="margin:30px;">
                                    <button type="button" class="close" data-hide="alert">&times;</button>
                                    <strong>@Resources1.Customer.InsertSuccess</strong>
                                </div>

                            </div>
                        </div>

                        <br />
                        <div class="row">
                            <div class="col-sm-12">
                                <h4 style="margin-top: 0px; color: #183666; font-family: 'Arial Bold'; font-size: 18pt; margin-left: 30px;">
                                    <b>@Resources.TTProjet.AddCustomerInfos</b>
                                </h4>
                            </div>
                        </div>
                        <br />

                        <div class="row">
                            <div class="col-lg-3">
                                <div class="row" style="color:steelblue; font-size:initial">
                                    <div class="form-group">
                                        <div class="col-sm-5" style="margin-top:20px; margin-left: 20px">
                                            <label>@Resources1.Customer.CustomerNumber</label>
                                        </div>
                                        <div class="input-group col-sm-1" style="float:left; margin-top: 10px; width:45%">
                                            <input type="text" class="form-control formControl2 inputWidth2 text-box single-line lightBlue" id="CustomerNumber" style="" value="">
                                        </div>
                                        <div class="col-sm-1" style="color: red;">
                                            <h3 class="pull-left" style="margin-top: 10px;">*</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="row" style="color:steelblue; font-size:initial">
                                    <div class="col-sm-5" style="margin-top: 20px; margin-left: 20px">
                                        <label>@Resources1.Customer.CustomerName</label>
                                    </div>
                                    <div class="input-group col-sm-1" style="float:left; margin-top: 10px; width:45%">
                                        <input class="form-control formControl2 inputWidth2 text-box single-line lightBlue" id="CustomerName" name="" style="" type="text" value="">
                                    </div>
                                    <div class="col-sm-1" style="color: red;">
                                        <h3 class="pull-left" style="margin-top: 10px;">*</h3>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3">
                                <div class="row" style="color:steelblue; font-size:initial">
                                    <div class="col-sm-5" style="margin-top: 20px; margin-left: 25px">
                                        <label>@Resources1.Customer.Reference</label>
                                    </div>
                                    <div class="input-group col-lg-4" style="float:left; margin-top: 10px; width:45%">
                                        <input class="form-control formControl2 inputWidth2 text-box single-line lightBlue" id="Reference" name="" style="" type="text" value="">
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3">
                                <div class="form-group" style="margin-top: 10px;">
                                    <button type="button" class="btn btn-info" onclick="actionButton()">@Resources1.Customer.Insert</button>
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-sm-12">
                                <div style="border-radius: 10px">
                                    <div class="panel pagination-grey clearfix m-b-0">
                                        <div id="data-table_wrapper1" class="dataTables_wrapper form-inline dt-bootstrap no-footer" style=" margin-right: 10px; margin-left: 10px">
                                            <table id="data_customer" class=" table table-bordered  data-table  dataTable display" style="margin-top: -50px; width: 100%; font-size: 12px;">
                                                <thead id="tableHeaderGP">
                                                    <tr style="font-style:italic; "></tr>
                                                    <tr class="grey" role="row">

                                                        <th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Date: activate to sort column ascending" style="width: 15%">
                                                            <a>@Resources1.Customer.CustomerNumber</a>
                                                        </th>
                                                        <th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Date: activate to sort column ascending" style="width: 40%">
                                                            <a>@Resources1.Customer.CustomerName</a>
                                                        </th>
                                                        <th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Date: activate to sort column ascending">
                                                            <a>@Resources1.Customer.CreatedBy</a>
                                                        </th>
                                                        <th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Date: activate to sort column ascending">
                                                            <a>@Resources1.Customer.Reference</a>
                                                        </th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @for (var i = 0; i < Model.ListCustomerModel.Count(); i++)
                                                    {

                                                        <tr>
                                                            <td style="text-align: left;">
                                                                @Model.ListCustomerModel[i].Customer_Number
                                                            </td>
                                                            <td style="text-align: left;">
                                                                @Model.ListCustomerModel[i].Customer_Name
                                                            </td>
                                                            <td style="text-align: left;">
                                                                @Model.ListCustomerModel[i].CreatedBy
                                                            </td>
                                                            <td style="text-align: left;">
                                                                @Model.ListCustomerModel[i].Reference
                                                            </td>

                                                        </tr>
                                                    }

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {
        $('#data_customer').DataTable({
            pageResize: true,
            pageLength: 10,
            select: true,
            scrollX: true,
            scrollY: $(window).height() <= 722 ? $(window).height() / 3.5 : $(window).height() / 2,
            scrollCollapse: true,
            language: {
                "url": '@Session["lang"].ToString()' == 'fr' ? "/Content/assets/French.json" : "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/English.json",
                select: {
                    rows: '@Session["lang"].ToString()' == 'fr' ? '' : ''
                }
            },
        });
        $('#data_customer').DataTable().draw();
    });

    $('#data_customer thead').on('keyup', ".column_search", function () {

        $('#data_customer').DataTable()
            .column($(this).parent().index())
            .search(this.value)
            .draw();
    });


    function actionButton()
    {
        var customernumber1 = $('#CustomerNumber').val()
        var customername1 = $('#CustomerName').val()
        var Reference1 = $('#Reference').val()

        
        if (customernumber1 != '') {
            if ($.isNumeric(customernumber1)) {
                if (customername1 != '') {
                    $.ajax({
                    type: 'GET',
                    cache: false,
                    async: false,
                    dataType: "JSON",
                    data: {
                        CustomerNumber: customernumber1
                        },
                    url: '@Url.Action("returnExistCustomerNumber", "Customer")',
                    success: function (response) {
                        if (response.result == "exist")
                        {
                            $("#alreadyExists").show();
                            setTimeout(function () {
                                $('#alreadyExists').fadeOut('slow');
                            }, 60000
                            );
                        }
                        else {
                            $.ajax({
                                type: 'GET',
                                cache: false,
                                async: false,
                                dataType: "JSON",
                                data: {
                                    CustomerNumber: customernumber1,
                                    CustomerName: customername1,
                                    CreatedBy: '@UserService.CurrentUser.FullName',
                                    Reference: Reference1
                                    },
                                url: '@Url.Action("InsertInfos", "Customer")',
                                success: function (response) {
                                    if (response.result == "success")
                                    {
                                        $("#successAdd").show();
                                        setTimeout(function () {
                                            $('#successAdd').fadeOut('slow');
                                        }, 80000
                                        );
                                        location.reload(true);
                                    }
                                    else {
                                        alert(response.details1 + " / " + response.details2)
                                    }
                                },
                                error: function () {
                                }
                                });
                        }
                    },
                    error: function () {
                    }
                  });
                }
                else {
                    $("#CustomerNameMissing").show();
                    setTimeout(function () {
                        $('#CustomerNameMissing').fadeOut('slow');
                    }, 60000
                    );
                }
            }
            else {
                $("#ValNumeric").show();
                setTimeout(function () {
                    $('#ValNumeric').fadeOut('slow');
                }, 60000
                );
            }
        }
        else {
            $("#CustomerNumberMissing").show();
            setTimeout(function () {
                $('#CustomerNumberMissing').fadeOut('slow');
            }, 60000
            );
        }
    }

    $(".close").click(function () {
        $(".alert").hide();

    });





</script>
